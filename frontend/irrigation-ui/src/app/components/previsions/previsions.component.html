<div>
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <h2>ğŸŒ¤ï¸ PrÃ©visions MÃ©tÃ©o</h2>
    <button class="btn btn-primary" (click)="toggleForm()" [disabled]="stations.length === 0">
      {{ showForm ? 'âŒ Annuler' : 'â• Nouvelle PrÃ©vision' }}
    </button>
  </div>

  <div class="alert alert-success" *ngIf="success">
    {{ success }}
  </div>

  <div class="alert alert-error" *ngIf="error">
    {{ error }}
  </div>

  <div class="alert alert-error" *ngIf="stations.length === 0 && !loading">
    âš ï¸ Aucune station disponible. Veuillez d'abord crÃ©er une station mÃ©tÃ©o.
  </div>

  <!-- Formulaire de crÃ©ation -->
  <div class="card" *ngIf="showForm && stations.length > 0">
    <h3>Nouvelle PrÃ©vision MÃ©tÃ©o</h3>
    <form (ngSubmit)="createPrevision()">
      <div class="form-group">
        <label for="stationId">Station MÃ©tÃ©o *</label>
        <select id="stationId" [(ngModel)]="newPrevision.stationId" name="stationId" required>
          <option *ngFor="let station of stations" [value]="station.id">
            {{ station.nom }} ({{ station.latitude }}, {{ station.longitude }})
          </option>
        </select>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <div class="form-group">
          <label for="dateDebut">Date DÃ©but *</label>
          <input 
            type="date" 
            id="dateDebut" 
            [(ngModel)]="newPrevision.dateDebut" 
            name="dateDebut" 
            required>
        </div>

        <div class="form-group">
          <label for="dateFin">Date Fin *</label>
          <input 
            type="date" 
            id="dateFin" 
            [(ngModel)]="newPrevision.dateFin" 
            name="dateFin" 
            required>
        </div>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <div class="form-group">
          <label for="temperatureMax">TempÃ©rature Max (Â°C) *</label>
          <input 
            type="number" 
            id="temperatureMax" 
            [(ngModel)]="newPrevision.temperatureMax" 
            name="temperatureMax" 
            step="0.1" 
            required>
        </div>

        <div class="form-group">
          <label for="temperatureMin">TempÃ©rature Min (Â°C) *</label>
          <input 
            type="number" 
            id="temperatureMin" 
            [(ngModel)]="newPrevision.temperatureMin" 
            name="temperatureMin" 
            step="0.1" 
            required>
        </div>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <div class="form-group">
          <label for="pluiePrevue">Pluie PrÃ©vue (mm) *</label>
          <input 
            type="number" 
            id="pluiePrevue" 
            [(ngModel)]="newPrevision.pluiePrevue" 
            name="pluiePrevue" 
            step="0.1" 
            min="0" 
            required>
        </div>

        <div class="form-group">
          <label for="vent">Vent (km/h) *</label>
          <input 
            type="number" 
            id="vent" 
            [(ngModel)]="newPrevision.vent" 
            name="vent" 
            step="1" 
            min="0" 
            required>
        </div>
      </div>

      <button type="submit" class="btn btn-success" [disabled]="loading">
        {{ loading ? 'CrÃ©ation...' : 'âœ… CrÃ©er la PrÃ©vision (+ Event RabbitMQ)' }}
      </button>
    </form>
  </div>

  <!-- Liste des prÃ©visions -->
  <div *ngIf="loading && !showForm" class="loading">
    Chargement des prÃ©visions
  </div>

  <div class="grid" *ngIf="!loading && previsions.length > 0">
    <div class="card" *ngFor="let prevision of previsions">
      <h3>ğŸŒ¤ï¸ PrÃ©vision #{{ prevision.id }}</h3>
      <p><strong>ğŸ“… PÃ©riode:</strong> {{ prevision.dateDebut }} â†’ {{ prevision.dateFin }}</p>
      <p><strong>ğŸŒ¡ï¸ TempÃ©ratures:</strong> {{ prevision.temperatureMin }}Â°C ~ {{ prevision.temperatureMax }}Â°C</p>
      <p><strong>ğŸŒ§ï¸ Pluie:</strong> {{ prevision.pluiePrevue }} mm</p>
      <p><strong>ğŸ’¨ Vent:</strong> {{ prevision.vent }} km/h</p>
      <p *ngIf="prevision.stationId"><strong>ğŸ“ Station:</strong> {{ getStationName(prevision.stationId) }}</p>
      <div style="margin-top: 15px;">
        <button class="btn btn-danger" (click)="deletePrevision(prevision.id!)">
          ğŸ—‘ï¸ Supprimer
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="!loading && previsions.length === 0 && !showForm" style="text-align: center; padding: 40px; color: #999;">
    <p style="font-size: 18px;">Aucune prÃ©vision enregistrÃ©e.</p>
    <p>Cliquez sur "Nouvelle PrÃ©vision" pour en crÃ©er une.</p>
  </div>
</div>
