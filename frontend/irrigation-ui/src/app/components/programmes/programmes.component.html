<div>
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <h2>ğŸ’§ Programmes d'Arrosage</h2>
    <button class="btn btn-primary" (click)="toggleForm()">
      {{ showForm ? 'âŒ Annuler' : 'â• Nouveau Programme' }}
    </button>
  </div>

  <div class="alert alert-success" *ngIf="success">
    {{ success }}
  </div>

  <div class="alert alert-error" *ngIf="error">
    {{ error }}
  </div>

  <!-- Formulaire de crÃ©ation -->
  <div class="card" *ngIf="showForm">
    <h3>Nouveau Programme d'Arrosage</h3>
    <form (ngSubmit)="createProgramme()">
      <div class="form-group">
        <label for="dateDebut">Date de DÃ©but *</label>
        <input 
          type="date" 
          id="dateDebut" 
          [(ngModel)]="newProgramme.dateDebut" 
          name="dateDebut" 
          required>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <div class="form-group">
          <label for="heure">Heure (0-23) *</label>
          <input 
            type="number" 
            id="heure" 
            [(ngModel)]="newProgramme.heure" 
            name="heure" 
            min="0" 
            max="23" 
            required>
        </div>

        <div class="form-group">
          <label for="duree">DurÃ©e (minutes) *</label>
          <input 
            type="number" 
            id="duree" 
            [(ngModel)]="newProgramme.duree" 
            name="duree" 
            min="1" 
            required>
        </div>
      </div>

      <div class="form-group">
        <label for="volumeEau">Volume d'Eau (Litres) *</label>
        <input 
          type="number" 
          id="volumeEau" 
          [(ngModel)]="newProgramme.volumeEau" 
          name="volumeEau" 
          min="1" 
          step="0.1" 
          required>
      </div>

      <div class="form-group">
        <label for="etatPrevuInitial">Ã‰tat Initial *</label>
        <select id="etatPrevuInitial" [(ngModel)]="newProgramme.etatPrevuInitial" name="etatPrevuInitial" required>
          <option value="PLANIFIE">PLANIFIE</option>
          <option value="AJUSTE">AJUSTE</option>
        </select>
      </div>

      <div class="form-group" style="display: flex; align-items: center; gap: 10px;">
        <input 
          type="checkbox" 
          id="useMeteo" 
          [(ngModel)]="useMeteo" 
          name="useMeteo">
        <label for="useMeteo" style="margin: 0;">ğŸŒ¤ï¸ Utiliser les donnÃ©es mÃ©tÃ©o pour ajuster automatiquement</label>
      </div>

      <div class="form-group" *ngIf="useMeteo && stations.length > 0">
        <label for="stationMeteoId">Station MÃ©tÃ©o</label>
        <select id="stationMeteoId" [(ngModel)]="newProgramme.stationMeteoId" name="stationMeteoId">
          <option *ngFor="let station of stations" [value]="station.id">
            {{ station.nom }}
          </option>
        </select>
      </div>

      <button type="submit" class="btn btn-success" [disabled]="loading">
        {{ loading ? 'CrÃ©ation...' : 'âœ… CrÃ©er le Programme' }}
      </button>
    </form>
  </div>

  <!-- Liste des programmes -->
  <div *ngIf="loading && !showForm" class="loading">
    Chargement des programmes
  </div>

  <div class="grid" *ngIf="!loading && programmes.length > 0">
    <div class="card" *ngFor="let programme of programmes">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
        <h3>ğŸ’§ Programme #{{ programme.id }}</h3>
        <span class="badge" [ngClass]="getStatutBadgeClass(programme.etatPrevuInitial)">
          {{ programme.etatPrevuInitial }}
        </span>
      </div>
      <p><strong>ğŸ“… Date:</strong> {{ programme.dateDebut }} Ã  {{ programme.heure }}h</p>
      <p><strong>â±ï¸ DurÃ©e:</strong> {{ programme.duree }} minutes</p>
      <p><strong>ğŸ’§ Volume:</strong> {{ programme.volumeEau }} L</p>
      <div *ngIf="programme.temperatureMax">
        <p><strong>ğŸŒ¡ï¸ TempÃ©rature Max:</strong> {{ programme.temperatureMax }}Â°C</p>
        <p><strong>ğŸŒ¡ï¸ TempÃ©rature Min:</strong> {{ programme.temperatureMin }}Â°C</p>
        <p><strong>ğŸŒ§ï¸ Pluie:</strong> {{ programme.pluiePrevue ? 'Oui' : 'Non' }}</p>
        <p><strong>ğŸ’¨ Vent:</strong> {{ programme.vent }} km/h</p>
      </div>
      <div style="margin-top: 15px; display: flex; gap: 10px;">
        <button class="btn btn-success" (click)="executerProgramme(programme.id!)">
          â–¶ï¸ ExÃ©cuter
        </button>
        <button class="btn btn-danger" (click)="deleteProgramme(programme.id!)">
          ğŸ—‘ï¸ Supprimer
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="!loading && programmes.length === 0 && !showForm" style="text-align: center; padding: 40px; color: #999;">
    <p style="font-size: 18px;">Aucun programme d'arrosage enregistrÃ©.</p>
    <p>Cliquez sur "Nouveau Programme" pour en crÃ©er un.</p>
  </div>
</div>
